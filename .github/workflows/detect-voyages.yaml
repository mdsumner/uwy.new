name: Detect Voyages

on:
  schedule:
    # Weekly on Sunday at 4am UTC
    - cron: '0 4 * * 0'
  workflow_dispatch:

permissions:
  contents: write

env:
  RELEASE_TAG: v0.0.1

jobs:
  detect:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout
        uses: actions/checkout@v4
      
      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.12'
      
      - name: Install dependencies
        run: pip install duckdb
      
      - name: Run voyage detection
        run: python scripts/detect_voyages.py
      
      - name: Show output
        run: |
          echo "=== voyages_draft.json ==="
          cat voyages_draft.json
      
      - name: Upload to release
        uses: softprops/action-gh-release@v1
        with:
          tag_name: ${{ env.RELEASE_TAG }}
          files: voyages_draft.json
          fail_on_unmatched_files: true
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
